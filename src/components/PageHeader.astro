---
import { defaultLang, stripLangFromPath, useTranslations, type Lang } from '~/i18n/config'

interface Props {
  title?: string
  titlePieces?: string[]
  lang?: Lang
}

const { title, titlePieces, lang = defaultLang } = Astro.props as Props
const t = useTranslations(lang)

const translationMap: Record<string, string> = {
  home: t('breadcrumbs.home'),
  posts: t('breadcrumbs.posts'),
  tags: t('breadcrumbs.tags'),
  series: t('breadcrumbs.series'),
  page: t('breadcrumbs.page'),
}

const strippedPath = stripLangFromPath(Astro.url.pathname)

const splitPath: string[] = strippedPath
  .split('/')
  .filter(Boolean)
  .map((part) => decodeURIComponent(part))

const resolvePiece = (value: string) => {
  const key = value.toLowerCase()
  return translationMap[key] || value
}

const pieces = (titlePieces ?? splitPath).map(resolvePiece)

if (pieces.length === 0) {
  pieces.push(t('breadcrumbs.home'))
}

const titleFromPieces = pieces.map((part) => `/ ${part}`)
---

<div
  class="border-0 border-accent/30 bg-accent/6 rounded-xl inline-block py-2.5 pl-3 pr-4 mt-5 md:mt-8"
>
  <h1 class="text-accent text-2xl font-semibold flex flex-wrap gap-y-2 gap-x-3.5">
    {title ? <span>// {title}</span> : titleFromPieces.map((part) => <span>{part}</span>)}
  </h1>
</div>
